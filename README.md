# EcoStream environment setup

---

:warning:
**This project was originally hosted on GitLab and moved to GitHub when I reached GitLab's free tier limit.**
**I have left the .gitlab-ci.yml files as is, most of the instructions to deploy the application will not work because they rely on GitLab's services (e.g. container registries)**

**TODO: update all EcoStream repositories to use GitHub actions and some independent container registry instead of GitLab services.**

---

This repository contains resources that helps deploying EcoStream on the cloud.
There are two main directories here:
- tofu-infrastructure-provisioning which contains Open Tofu (Terraform) configuration files that allows deploying an EKS Cluster and corresponding resources to AWS
- ansible-environment-configuration which contains an Ansible playbook that finishes configuring the environment and deploys EcoStream to the EKS cluster

## AWS Access

The access key used by gitlab-ci and passed in to tofu via https://gitlab.com/gkermo/ecostream-environment-setup/-/settings/ci_cd#js-cicd-variables-settings are the ones of ecostream-gitlab-ci user in AWS.
That user belongs to the ecostream-admins group which has all the required permissions to deploy the infrastructure defined here

## [Optional] HTTPS and custom host name

By default, you can only access EcoStream with HTTP, using the address generated by AWS Load Balancer Controller.

If you want to access EcoStream with HTTPS, you need to use a host name that you own:
- you must have a Route 53 Hosted Zone for your host name
- an ACM certificate must be issued for your host name

You can then pass the host name and the ACM certificate ARN to the Helm chart / ArgoCD via `values.yaml file`.
In this case, ExternalDNS will create records in Route 53 Hosted Zone so the host name redirects to EcoStream ALB (Application Load Balancers).